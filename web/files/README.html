<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <title>irace: An implementation in R of Iterated Race</title>
  <style type="text/css">code{white-space: pre;}</style>
  <style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; }
code > span.dt { color: #902000; }
code > span.dv { color: #40a070; }
code > span.bn { color: #40a070; }
code > span.fl { color: #40a070; }
code > span.ch { color: #4070a0; }
code > span.st { color: #4070a0; }
code > span.co { color: #60a0b0; font-style: italic; }
code > span.ot { color: #007020; }
code > span.al { color: #ff0000; font-weight: bold; }
code > span.fu { color: #06287e; }
code > span.er { color: #ff0000; font-weight: bold; }
  </style>
</head>
<body>
<div id="header">
<h1 class="title">irace: An implementation in R of Iterated Race</h1>
</div>
<div id="TOC">
<ul>
<li><a href="#requisites">Requisites</a></li>
<li><a href="#installing-r">Installing R</a><ul>
<li><a href="#gnulinux">GNU/Linux</a></li>
<li><a href="#os-x">OS X</a></li>
<li><a href="#windows">Windows</a></li>
</ul></li>
<li><a href="#installing-the-irace-package">Installing the irace package</a><ul>
<li><a href="#gnulinux-and-os-x">GNU/Linux and OS X</a></li>
<li><a href="#windows-1">Windows</a></li>
</ul></li>
<li><a href="#usage">Usage</a></li>
<li><a href="#many-tuning-runs-in-parallel">Many tuning runs in parallel</a></li>
<li><a href="#parallelize-one-tuning">Parallelize one tuning</a></li>
<li><a href="#frequently-asked-questions">Frequently Asked Questions</a><ul>
<li><a href="#is-irace-minimizing-or-maximizing-the-output-of-my-algorithm">Is irace minimizing or maximizing the output of my algorithm?</a></li>
<li><a href="#is-it-possible-to-configure-a-matlab-algorithm-with-irace">Is it possible to configure a MATLAB algorithm with irace?</a></li>
<li><a href="#my-program-works-perfectly-on-its-own-but-not-when-running-under-irace.-is-irace-broken">My program works perfectly on its own, but not when running under irace. Is irace broken?</a></li>
<li><a href="#my-program-may-be-buggy-and-run-into-an-infinite-loop.-is-it-possible-to-set-a-maximum-timeout">My program may be buggy and run into an infinite loop. Is it possible to set a maximum timeout?</a></li>
</ul></li>
<li><a href="#contact">Contact</a></li>
</ul>
</div>
<p><a href="http://iridia.ulb.ac.be/~manuel/">Manuel L&#243;pez-Ib&#225;&#241;ez</a>, J&#233;r&#233;mie Dubois-Lacoste</p>
<p>Contact email: irace@iridia.ulb.ac.be</p>
<h2 id="requisites">Requisites</h2>
<ul>
<li><p>R (<a href="http://www.r-project.org" class="uri">http://www.r-project.org</a>) is required for running irace, but you don't need to know the R language to use it. Versions that work: &gt;= 2.14.0 (See Installing R below for a quick install guide)</p></li>
<li><p>If you wish to use the command-line wrappers <code>irace</code> and <code>parallel-irace</code>, they require GNU Bash.</p></li>
</ul>
<h2 id="installing-r">Installing R</h2>
<p>The official instructions are available at <a href="http://cran.r-project.org/doc/manuals/r-release/R-admin.html" class="uri">http://cran.r-project.org/doc/manuals/r-release/R-admin.html</a></p>
<p>We give below a quick installation guide that will work in most cases.</p>
<h3 id="gnulinux">GNU/Linux</h3>
<p>You should install R from your package manager. On a Debian/Ubuntu system it will be something like:</p>
<pre><code>$ sudo apt-get install r-base</code></pre>
<p>Once R is installed, you can launch R from the Terminal and from the R prompt install the irace package. See instructions below.</p>
<h3 id="os-x">OS X</h3>
<p>You can install R directly from a CRAN mirror (the link of the Belgian one is <a href="http://cran.freestatistics.org/bin/macosx/" class="uri">http://cran.freestatistics.org/bin/macosx/</a>)</p>
<p>Alternatively, if you use homebrew, you can just brew the R formula from the science tap (unfortunately it does not come already bottled so you need to have Xcode installed to compile it):</p>
<pre><code>$ brew tap homebrew/science
$ brew install r</code></pre>
<p>Once R is installed, you can launch R from the Terminal (or from your Applications), and from the R prompt install the irace package. See instructions below.</p>
<h3 id="windows">Windows</h3>
<p>You can install R from a CRAN mirror (the link for the Belgian one is <a href="http://cran.freestatistics.org/bin/windows/" class="uri">http://cran.freestatistics.org/bin/windows/</a>)</p>
<p>Once R is installed, you can launch the R console and install the irace package from it. See instructions below.</p>
<h2 id="installing-the-irace-package">Installing the irace package</h2>
<p>Install the <a href="http://iridia.ulb.ac.be/irace">irace</a> R package on your computer. There are two methods:</p>
<ol style="list-style-type: decimal">
<li>Install within R (automatic download):</li>
</ol>
<pre class="sourceCode r"><code class="sourceCode r">        $<span class="st"> </span>R
        R&gt;<span class="st"> </span><span class="kw">install.packages</span>(<span class="st">&quot;irace&quot;</span>)</code></pre>
<p>select a mirror close to you, and test the installation with</p>
<pre class="sourceCode r"><code class="sourceCode r">        R&gt;<span class="st"> </span><span class="kw">library</span>(irace)
        R&gt;<span class="st"> </span>CTRL+d</code></pre>
<ol start="2" style="list-style-type: decimal">
<li><p>Manually <a href="http://cran.r-project.org/package=irace">download the package from CRAN</a> and invoke at the command-line:</p>
<pre><code>$ R CMD INSTALL &lt;package&gt;</code></pre></li>
</ol>
<p>where <code>&lt;package&gt;</code> is one of the three versions available: <code>.tar.gz</code> (Unix/BSD/GNU/Linux), <code>.tgz</code> (MacOS X), or <code>.zip</code> (Windows).</p>
<p>If the package fails to install because of insufficient permissions, you need to force a <em>local installation</em> by doing:</p>
<pre class="sourceCode bash"><code class="sourceCode bash">    $ <span class="kw">mkdir</span> ~/R
    $ <span class="kw">R</span> CMD INSTALL --library=~/R irace.tar.gz
    $ <span class="kw">export</span> <span class="ot">R_LIBS=</span>~/R:<span class="ot">${R_LIBS}</span></code></pre>
<p>Once installed, test that it is working by doing:</p>
<pre class="sourceCode r"><code class="sourceCode r">    $<span class="st"> </span>R
    R&gt;<span class="st"> </span><span class="kw">library</span>(irace)
    R&gt;<span class="st"> </span><span class="kw">system.file</span>(<span class="dt">package=</span><span class="st">&quot;irace&quot;</span>)
    [<span class="dv">1</span>] <span class="st">&quot;~/R/irace&quot;</span></code></pre>
<h3 id="gnulinux-and-os-x">GNU/Linux and OS X</h3>
<p>The last command tells you the installation directory of <code>irace</code>. Save that path to a variable, and add it to your <code>.bash_profile</code>, <code>.bashrc</code> or <code>.profile</code>:</p>
<pre class="sourceCode bash"><code class="sourceCode bash">    <span class="kw">export</span> <span class="ot">IRACE_HOME=</span>~/R/irace/ <span class="co"># Path given by system.file(package=&quot;irace&quot;)</span>
    <span class="kw">export</span> <span class="ot">PATH=${IRACE_HOME}</span>/bin/:<span class="ot">$PATH</span>
    <span class="co"># export R_LIBS=~/R:${R_LIBS} # Only if local installation was forced</span></code></pre>
<p>After adding this and opening a new terminal, you should be able to invoke <code>irace</code> as follows:</p>
<pre class="sourceCode bash"><code class="sourceCode bash">    $ <span class="kw">irace</span> --help</code></pre>
<h3 id="windows-1">Windows</h3>
<p>Unfortunately, the command-line wrapper does not work in Windows. To launch irace, you need to open the R console and execute:</p>
<pre class="sourceCode r"><code class="sourceCode r">    R&gt;<span class="st"> </span><span class="kw">library</span>(irace)
    R&gt;<span class="st"> </span><span class="kw">irace.cmdline</span>(<span class="st">&quot;--help&quot;</span>)</code></pre>
<h2 id="usage">Usage</h2>
<ol style="list-style-type: decimal">
<li>Create a directory for storing the configuration of the tuning</li>
</ol>
<pre class="sourceCode bash"><code class="sourceCode bash">        $ <span class="kw">mkdir</span> ~/tuning
        $ <span class="kw">cd</span> ~/tuning</code></pre>
<ol start="2" style="list-style-type: decimal">
<li><p>Copy the template and example files to the tuning directory</p>
<pre class="sourceCode bash"><code class="sourceCode bash">    $ <span class="kw">cp</span> <span class="ot">$IRACE_HOME</span>/templates/*.tmpl .</code></pre>
<p>where <code>$IRACE_HOME</code> is the path to the installation directory of <code>irace</code>. It can be obtained by doing:</p></li>
</ol>
<pre class="sourceCode r"><code class="sourceCode r">        $<span class="st"> </span>R
        &gt;<span class="st"> </span><span class="kw">library</span>(irace)
        &gt;<span class="st"> </span><span class="kw">system.file</span>(<span class="dt">package=</span><span class="st">&quot;irace&quot;</span>)</code></pre>
<ol start="3" style="list-style-type: decimal">
<li><p>For each template in your tuning directory, remove the <code>.tmpl</code> suffix, and modify them following the instructions in each file. In particular,</p>
<ul>
<li><code>tune-main.tmpl</code> should be adjusted depending on your usage (local, cluster, etc).</li>
<li>The scripts <code>hook-run</code>, <code>hook-evaluate</code> (if you need it at all) and <code>tune-main</code> should be executable. The output of <code>hook-run</code> (or <code>hook-evaluate</code> if you use a separate evaluation step) is minimized by default. If you wish to maximize it, just multiply the value by <code>-1</code> within the script.</li>
<li>In <code>tune-conf</code>, uncomment and assign only the parameters for which you need a value different than the default one.</li>
</ul>
<p>There are examples in <code>$IRACE_HOME/examples/</code>.</p></li>
<li><p>Put the instances in <code>~/tuning/Instances/</code>. In addition, you can create a file that specifies which instances from that directory should be run and which instance-specific parameters to use. See <code>tune-conf.tmpl</code> and <code>instances-list.tmpl</code> for examples. The command irace will not attempt to create the execution directory (execDir), so it must exist before calling irace. The default execDir is the current directory.</p></li>
<li><p>Calling the command:</p>
<pre class="sourceCode bash"><code class="sourceCode bash">    $ <span class="kw">cd</span> ~/tuning/ <span class="kw">&amp;&amp;</span> <span class="ot">$IRACE_HOME</span><span class="kw">/bin/irace</span></code></pre>
<p>performs one run of Iterated Race. See the output of <code>irace --help</code> for additional configuration parameters. Command-line parameters override the configuration specified in the tune-conf file.</p></li>
</ol>
<h2 id="many-tuning-runs-in-parallel">Many tuning runs in parallel</h2>
<p>For executing several repetitions of irace in parallel, call the program</p>
<pre class="sourceCode bash"><code class="sourceCode bash">    $ <span class="kw">cd</span> ~/tuning/ <span class="kw">&amp;&amp;</span> <span class="ot">$IRACE_HOME</span><span class="kw">/bin/parallel-irace</span> N</code></pre>
<p>where N is the number of repetitions. By default, the execution directory of each run of irace will be set to <code>./TUNE-dd</code>, where dd is a number padded with zeroes.</p>
<p><strong>Be careful</strong>, <code>parallel-irace</code> will create these directories from scratch, deleting them first if they already exist.</p>
<p>Check the help of <code>parallel-irace</code> by running it without parameters.</p>
<h2 id="parallelize-one-tuning">Parallelize one tuning</h2>
<p>A single run of irace can be done much faster by executing the calls to <code>hookRun</code> (the runs of the algorithm being tuned) in parallel. There are three ways to parallelize a single run of irace.</p>
<ol style="list-style-type: decimal">
<li><p>Parallel processes: The option <code>--parallel N</code> will use the <code>parallel</code> package to launch <em>locally</em> up to N calls of <code>hookRun</code> in parallel.</p></li>
<li><p>MPI: The option <code>--mpi 1 --parallel N</code> will use the Rmpi package to launch N slaves + 1 master, in order to execute N calls of <code>hookRun</code> in parallel. The user is responsible to set up MPI correctly.</p>
<p>An example script for using MPI mode in an SGE cluster is given at <code>$IRACE_HOME/examples/mpi/</code>.</p></li>
<li><p>SGE cluster: This mode requires Grid Engine commands qsub and qstat. The command qsub should return a message that contains the string: <code>Your job JOBID</code>. The command <code>qstat -j JOBID</code> should return nonzero if JOBID has finished, otherwise it should return zero.</p>
<p>The option <code>--sge-cluster 1</code> will launch as many calls of <code>hookRun</code> as possible and use <code>qstat</code> to wait for cluster jobs. The user <em>must</em> call <code>qsub</code> from <code>hookRun</code> with the appropriate configuration for their cluster, otherwise <code>hookRun</code> will not submit jobs to the cluster. In this mode, irace must run in the submission node, and hence, qsub should not be used to invoke irace (either directly or through tune-main). You also need to create a separate hookEvaluate script to parse the results of the hookRun and return them to irace. See the examples in <code>$IRACE_HOME/examples/sge-cluster/</code>.</p></li>
</ol>
<h2 id="frequently-asked-questions">Frequently Asked Questions</h2>
<h4 id="is-irace-minimizing-or-maximizing-the-output-of-my-algorithm">Is irace minimizing or maximizing the output of my algorithm?</h4>
<p>By default, irace considers that the value returned by <code>hook-run</code> (or by <code>hook-evaluate</code>, if used) should be minimized. In case of a maximization problem, one can simply multiply the value by <code>-1</code> before returning it to irace. This is done, for example, when maximizing the hypervolume (see the last lines in <code>$IRACE_HOME/examples/hypervolume/hook-evaluate</code>).</p>
<h4 id="is-it-possible-to-configure-a-matlab-algorithm-with-irace">Is it possible to configure a MATLAB algorithm with irace?</h4>
<p>Definitely. There are two main ways to achieve this:</p>
<ol style="list-style-type: decimal">
<li><p>Edit the hook-run script to call MATLAB in a non-interactive way. See the MATLAB documentation, or the following links: <a href="http://stackoverflow.com/questions/1518072/suppress-start-message-of-matlab/" class="uri">http://stackoverflow.com/questions/1518072/suppress-start-message-of-matlab/</a> <a href="http://stackoverflow.com/questions/4611195/how-to-call-matlab-from-command-line-and-print-to-stdout-before-exiting" class="uri">http://stackoverflow.com/questions/4611195/how-to-call-matlab-from-command-line-and-print-to-stdout-before-exiting</a></p>
<p>You would need to pass the parameter received by hook-run to your MATLAB script: <a href="http://www.mathworks.nl/support/solutions/en/data/1-1BS5S/?solution=1-1BS5S" class="uri">http://www.mathworks.nl/support/solutions/en/data/1-1BS5S/?solution=1-1BS5S</a></p></li>
<li><p>Call MATLAB code directly from R using <a href="http://cran.r-project.org/package=R.matlab">R.matlab package</a>. This is a better option if you are experienced in R. Define hookRun as an R function instead of a path to a script. The function should call your MATLAB code with appropriate parameters.</p></li>
</ol>
<h4 id="my-program-works-perfectly-on-its-own-but-not-when-running-under-irace.-is-irace-broken">My program works perfectly on its own, but not when running under irace. Is irace broken?</h4>
<p>Every time this was reported, it was a difficult-to-reproduce bug in the program, not in irace. We recommend that in <code>hook-run</code>, you use <code>valgrind</code> to run your program. That is, if you program is called like:</p>
<pre class="sourceCode bash"><code class="sourceCode bash">    <span class="ot">$EXE</span> <span class="ot">${FIXED_PARAMS}</span> <span class="kw">-i</span> <span class="ot">$INSTANCE</span> <span class="ot">${CAND_PARAMS}</span> <span class="kw">1&gt;</span> <span class="ot">${STDOUT}</span> <span class="kw">2&gt;</span> <span class="ot">${STDERR}</span></code></pre>
<p>then replace that line with:</p>
<pre class="sourceCode bash"><code class="sourceCode bash">    <span class="kw">valgrind</span> --error-exitcode=1 <span class="ot">$EXE</span> <span class="ot">${FIXED_PARAMS}</span> -i <span class="ot">$INSTANCE</span> <span class="ot">${CAND_PARAMS}</span> <span class="kw">1&gt;</span> <span class="ot">${STDOUT}</span> <span class="kw">2&gt;</span> <span class="ot">${STDERR}</span></code></pre>
<p>If there are bugs in your program, they will appear in <code>${STDERR}</code>, thus do not delete those files.</p>
<h4 id="my-program-may-be-buggy-and-run-into-an-infinite-loop.-is-it-possible-to-set-a-maximum-timeout">My program may be buggy and run into an infinite loop. Is it possible to set a maximum timeout?</h4>
<p>We are not aware of any way to achieve this using R. However, in GNU/Linux, it is easy to implement by using the <code>timeout</code> command in <code>hook-run</code> when invoking your program.</p>
<h2 id="contact">Contact</h2>
<p>If you find that you need to modify anything else, something is not clear or if you have problems, please contact irace@iridia.ulb.ac.be</p>
<!--
Local Variables:
mode: markdown
End:
-->
</body>
</html>
